# This is a basic spec for the DCS world EDM files
# Special types:
#   uint_string   means a uint-prefixed string
#   zstring       would mean a null-terminated string
# Literal string prefixes:
#   b'data'       raw byte data - no prefix/suffix
#   uip"ssds"     UINT-prefixed string



INDEX_ENTRY :=
  uint_string name
  uint   index

INDEX := 
  uint length
  INDEX_ENTRY entries[length]

HEADER :=
  b"EDM"
  ushort version
  INDEX indexA
  INDEX indexB

NODELIST := 
  uint length
  NODE nodes[length]

VERTEXDEFSLIST :=
  uint length
  VERTEXDEFS defs[length]

VERTEXDEFS :=
  uint length
  VERTEXDEF defs[length]

VERTEXDEF := DEFBLENDING | DEFCULLING | DEFDEPTHBIAS | DEFVERTEXFORMAT | DEFTEXCOORDCHANNELS | DEFMATERIALNAME | DEFNAME | DEFUNIFORMS | DEFANIMATEDUNIFORMS | DEFTEXTURES

NODE := ROOTNODE | PROPNODE

PROPNODE := PROPFLOATNODE | PROPUINTNODE

ROOTNODE :=
  uip"model::RootNode"
  uint_string description
  uint version
  NODELIST properties
  byte unknown[145]
  VERTEXDEFSLIST vdefsList

PROPUINTNODE := 
  uip"model::Property<unsigned int>"
  uint_string name
  uint value

PROPFLOATNODE := 
  uip"model::Property<float>"
  uint_string name
  float value

DEFBLENDING :=
  uip"BLENDING"
  uchar mode

DEFCULLING := 
  uip"CULLING"
  uchar mode

DEFDEPTHBIAS :=
  uip"DEPTH_BIAS"
  uint mode

DEFVERTEXFORMAT :=
  uip"VERTEX_FORMAT"
  char format[30]

DEFTEXCOORDCHANNELS :=
  uip"TEXTURE_COORDINATES_CHANNELS"
  char channels[52]

DEFMATERIALNAME :=
  uip"MATERIAL_NAME"
  uint_string name

DEFNAME :=
  uip"NAME"
  uint_string name

DEFUNIFORMS :=
  uip"UNIFORMS"
  NODELIST uniformNames

DEFANIMATEDUNIFORMS :=
  uip"ANIMATED_UNIFORMS"
  NODELIST animatedUniforms

